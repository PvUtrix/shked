{
	"nodes":[
		{"id":"user-web","type":"text","text":"# 1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ –ø—Ä–æ—Ñ–∏–ª–µ\n\n## –î–µ–π—Å—Ç–≤–∏—è\n- –ó–∞—Ö–æ–¥–∏—Ç –≤ `/student/profile` –∏–ª–∏ `/lector/profile`\n- –í–∏–¥–∏—Ç —Ä–∞–∑–¥–µ–ª \"Telegram\"\n- –ù–∞–∂–∏–º–∞–µ—Ç \"–ü–æ–ª—É—á–∏—Ç—å —Ç–æ–∫–µ–Ω –¥–ª—è –ø—Ä–∏–≤—è–∑–∫–∏\"\n\n**API**: `GET /api/telegram/link`\n\n## –ü–æ–ª—É—á–∞–µ—Ç\n- –¢–æ–∫–µ–Ω (32 —Å–∏–º–≤–æ–ª–∞)\n- TTL: 15 –º–∏–Ω—É—Ç\n- –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏","x":-900,"y":-400,"width":340,"height":340,"color":"2"},
		{"id":"system-generate-token","type":"text","text":"# 2. –°–∏—Å—Ç–µ–º–∞ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ç–æ–∫–µ–Ω\n\n```typescript\nconst token = crypto\n  .randomBytes(32)\n  .toString('hex')\n\n// –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ Redis/–ë–î\nawait redis.setex(\n  `telegram-link:${token}`,\n  900, // 15 –º–∏–Ω—É—Ç\n  userId\n)\n```\n\n**–ú–æ–¥–µ–ª—å**: [[TelegramUser]]","x":-500,"y":-400,"width":340,"height":320,"color":"6"},
		{"id":"user-telegram","type":"text","text":"# 3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ Telegram\n\n## –î–µ–π—Å—Ç–≤–∏—è\n- –û—Ç–∫—Ä—ã–≤–∞–µ—Ç –±–æ—Ç–∞ @ShkedBot\n- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `/start`\n- –ü–æ–ª—É—á–∞–µ—Ç –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ\n- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `/link TOKEN`\n\n**Webhook**: `POST /api/telegram/webhook`\n\n[[Telegram –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è]]","x":-100,"y":-400,"width":340,"height":320,"color":"3"},
		{"id":"bot-validate","type":"text","text":"# 4. –ë–æ—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–æ–∫–µ–Ω\n\n## Validation\n```typescript\n// –ü–æ–ª—É—á–∏—Ç—å userId –∏–∑ Redis\nconst userId = await redis.get(\n  `telegram-link:${token}`\n)\n\nif (!userId) {\n  return '‚ùå –¢–æ–∫–µ–Ω –Ω–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω'\n}\n\nif (tokenExpired) {\n  return '‚ùå –¢–æ–∫–µ–Ω –∏—Å—Ç–µ–∫'\n}\n```\n\n**Handler**: `lib/telegram/commands.ts`","x":300,"y":-400,"width":340,"height":360,"color":"6"},
		{"id":"system-create-link","type":"text","text":"# 5. –°–∏—Å—Ç–µ–º–∞ —Å–æ–∑–¥–∞–µ—Ç —Å–≤—è–∑—å\n\n```typescript\nawait prisma.telegramUser.create({\n  data: {\n    userId,\n    telegramId: from.id.toString(),\n    chatId: chat.id.toString(),\n    username: from.username,\n    firstName: from.first_name,\n    lastName: from.last_name,\n    isActive: true,\n    notifications: true\n  }\n})\n\n// –£–¥–∞–ª–∏—Ç—å —Ç–æ–∫–µ–Ω\nawait redis.del(`telegram-link:${token}`)\n```\n\n**–ú–æ–¥–µ–ª—å**: [[TelegramUser]]","x":700,"y":-400,"width":380,"height":400,"color":"6"},
		{"id":"bot-confirm","type":"text","text":"# 6. –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ\n\n## Telegram\n‚úÖ \"–ê–∫–∫–∞—É–Ω—Ç —É—Å–ø–µ—à–Ω–æ –ø—Ä–∏–≤—è–∑–∞–Ω!\"\n\n–¢–µ–ø–µ—Ä—å —Ç–µ–±–µ –¥–æ—Å—Ç—É–ø–Ω—ã:\n- üìÖ –ü—Ä–æ—Å–º–æ—Ç—Ä —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è\n- üìù –î–æ–º–∞—à–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è\n- üîî –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è\n- üí¨ –ó–∞–ø—Ä–æ—Å—ã –Ω–∞ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–º —è–∑—ã–∫–µ\n\n–ü–æ–ø—Ä–æ–±—É–π:\n/schedule - —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ\n/homework - –¥–æ–º–∞—à–∫–∏\n–∏–ª–∏ –ø—Ä–æ—Å—Ç–æ –Ω–∞–ø–∏—à–∏ –≤–æ–ø—Ä–æ—Å!","x":-900,"y":100,"width":340,"height":380,"color":"3"},
		{"id":"usage-commands","type":"text","text":"# 7. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ - –ö–æ–º–∞–Ω–¥—ã\n\n## –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞\n- `/schedule` - —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è\n- `/tomorrow` - —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ –∑–∞–≤—Ç—Ä–∞\n- `/week` - —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ –Ω–µ–¥–µ–ª—é\n- `/homework` - –¥–æ–º–∞—à–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è\n- `/homework_due` - –±–ª–∏–∂–∞–π—à–∏–µ –¥–µ–¥–ª–∞–π–Ω—ã\n- `/settings` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π\n- `/help` - –ø–æ–º–æ—â—å\n\n**Handler**: `lib/telegram/commands.ts`\n**API**: [[Schedules API]], [[Homework API]]","x":-500,"y":100,"width":340,"height":400,"color":"3"},
		{"id":"usage-nlp","type":"text","text":"# 8. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ - NLP\n\n## –ï—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–π —è–∑—ã–∫\n–ë–æ—Ç –ø–æ–Ω–∏–º–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã:\n\nüí¨ \"–ö–æ–≥–¥–∞ –º–æ—è —Å–ª–µ–¥—É—é—â–∞—è –ø–∞—Ä–∞?\"\nüí¨ \"–ß—Ç–æ —É –º–µ–Ω—è –∑–∞–≤—Ç—Ä–∞?\"\nüí¨ \"–ü–æ–∫–∞–∂–∏ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ –Ω–µ–¥–µ–ª—é\"\nüí¨ \"–ö–∞–∫–∏–µ –¥–æ–º–∞—à–∫–∏ –µ—Å—Ç—å?\"\nüí¨ \"–ö–æ–≥–¥–∞ —Å–¥–∞–≤–∞—Ç—å –î–ó –ø–æ –º–∞—Ç–µ–º–∞—Ç–∏–∫–µ?\"\n\n## GigaChat API\n- –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ intent\n- –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤\n- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–∞\n\n**LLM**: `lib/telegram/llm.ts`","x":-100,"y":100,"width":340,"height":420,"color":"3"},
		{"id":"notifications-schedule","type":"text","text":"# 9. –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è - –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ\n\n## –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ\n**–ó–∞ 30 –º–∏–Ω—É—Ç –¥–æ –∑–∞–Ω—è—Ç–∏—è**\n\nüìö –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ:\n–ß–µ—Ä–µ–∑ 30 –º–∏–Ω—É—Ç:\n**–ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑**\nüìç –ê—É–¥. 123\nüïê 10:00-11:30\n\n**Cron**: –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç\n**Settings**: [[BotSettings]]\n\n---\n\n**–î–Ω–µ–≤–Ω—ã–µ —Å–≤–æ–¥–∫–∏ (7:00)**\nüåÖ –î–æ–±—Ä–æ–µ —É—Ç—Ä–æ!\n\nüìÖ –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è:\n...","x":300,"y":100,"width":340,"height":440,"color":"4"},
		{"id":"notifications-homework","type":"text","text":"# 10. –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è - –î–æ–º–∞—à–∫–∏\n\n## –î–µ–¥–ª–∞–π–Ω—ã\n**–ó–∞ 24 —á–∞—Å–∞**\n‚è∞ –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ!\n\nüìù –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è ‚Ññ1\n‚è≥ –û—Å—Ç–∞–ª–æ—Å—å: 24 —á–∞—Å–∞\nüìÖ –î–µ–¥–ª–∞–π–Ω: 05.11.2024 23:59\n\n---\n\n**–ó–∞ 2 —á–∞—Å–∞**\nüö® –°—Ä–æ—á–Ω–æ!\n\nüìù –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è ‚Ññ1\n‚è≥ –û—Å—Ç–∞–ª–æ—Å—å: 2 —á–∞—Å–∞\n\n---\n\n## –ü—Ä–æ–≤–µ—Ä–∫–∞\n‚úÖ –†–∞–±–æ—Ç–∞ –ø—Ä–æ–≤–µ—Ä–µ–Ω–∞!\n\nüìù –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è ‚Ññ1\n‚≠ê –û—Ü–µ–Ω–∫–∞: 9/10\n\n[[–°–∏—Å—Ç–µ–º–∞ –¥–æ–º–∞—à–Ω–∏—Ö –∑–∞–¥–∞–Ω–∏–π]]","x":700,"y":100,"width":340,"height":480,"color":"4"},
		{"id":"settings","type":"text","text":"# 11. –ù–∞—Å—Ç—Ä–æ–π–∫–∏\n\n## –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç\n\n### –í –±–æ—Ç–µ\n- `/settings` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏\n- –í–∫–ª—é—á–∏—Ç—å/–≤—ã–∫–ª—é—á–∏—Ç—å notifications\n\n### –í –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ\n- –û—Ç–≤—è–∑–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç\n- –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å—Ç–∞—Ç—É—Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è\n\n### Admin ([[BotSettings]])\n- –í—Ä–µ–º—è –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π (30 –º–∏–Ω)\n- –í—Ä–µ–º—è –¥–Ω–µ–≤–Ω—ã—Ö —Å–≤–æ–¥–æ–∫ (7:00)\n- –í–∫–ª—é—á–∏—Ç—å/–≤—ã–∫–ª—é—á–∏—Ç—å –≥–ª–æ–±–∞–ª—å–Ω–æ","x":-900,"y":600,"width":380,"height":400,"color":"5"},
		{"id":"overview","type":"text","text":"# Workflow: Telegram –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è\n\n–û—Ç –ø—Ä–∏–≤—è–∑–∫–∏ –∞–∫–∫–∞—É–Ω—Ç–∞ –¥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –±–æ—Ç–∞\n\n[[Telegram –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è]]\n[[ADR-004 Telegram –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è]]","x":-300,"y":-800,"width":400,"height":200,"color":"6"}
	],
	"edges":[
		{"id":"e1","fromNode":"user-web","toNode":"system-generate-token","label":"GET /api/telegram/link","fromSide":"right","toSide":"left"},
		{"id":"e2","fromNode":"system-generate-token","toNode":"user-telegram","label":"–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–æ–∫–µ–Ω","fromSide":"right","toSide":"left"},
		{"id":"e3","fromNode":"user-telegram","toNode":"bot-validate","label":"/link TOKEN","fromSide":"right","toSide":"left"},
		{"id":"e4","fromNode":"bot-validate","toNode":"system-create-link","label":"—Ç–æ–∫–µ–Ω –≤–∞–ª–∏–¥–µ–Ω","fromSide":"right","toSide":"left"},
		{"id":"e5","fromNode":"system-create-link","toNode":"bot-confirm","label":"—Å–≤—è–∑—å —Å–æ–∑–¥–∞–Ω–∞","fromSide":"left","toSide":"right"},
		{"id":"e6","fromNode":"bot-confirm","toNode":"usage-commands","label":"–Ω–∞—á–∏–Ω–∞–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å","fromSide":"right","toSide":"left"},
		{"id":"e7","fromNode":"bot-confirm","toNode":"usage-nlp","label":"–∏–ª–∏ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–π —è–∑—ã–∫","fromSide":"right","toSide":"left"},
		{"id":"e8","fromNode":"usage-commands","toNode":"notifications-schedule","label":"–∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è","fromSide":"right","toSide":"left"},
		{"id":"e9","fromNode":"usage-nlp","toNode":"notifications-schedule","label":"–∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è","fromSide":"right","toSide":"left"},
		{"id":"e10","fromNode":"notifications-schedule","toNode":"notifications-homework","fromSide":"right","toSide":"left"},
		{"id":"e11","fromNode":"notifications-homework","toNode":"settings","label":"–º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å","fromSide":"left","toSide":"right"},
		{"id":"e12","fromNode":"overview","toNode":"user-web","fromSide":"bottom","toSide":"right"}
	]
}