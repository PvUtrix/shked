# –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ–º

> –°–∏—Å—Ç–µ–º–∞ —Å–æ–∑–¥–∞–Ω–∏—è, –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ–º –∑–∞–Ω—è—Ç–∏–π

## –û–±–∑–æ—Ä

–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ–º - –∫–ª—é—á–µ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã –®–∫–µ–¥, –ø–æ–∑–≤–æ–ª—è—é—â–∞—è —Å–æ–∑–¥–∞–≤–∞—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –∑–∞–Ω—è—Ç–∏–π –¥–ª—è –≥—Ä—É–ø–ø —Å —É—á–µ—Ç–æ–º –ø–æ–¥–≥—Ä—É–ø–ø –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å—Ç—É–¥–µ–Ω—Ç–∞.

## –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### –î–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ ([[Admin]])
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–Ω—è—Ç–∏–π –¥–ª—è –ª—é–±—ã—Ö –≥—Ä—É–ø–ø
- ‚úÖ –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∑–∞–Ω—è—Ç–∏–π
- ‚úÖ –£–¥–∞–ª–µ–Ω–∏–µ –∑–∞–Ω—è—Ç–∏–π
- ‚úÖ –ú–∞—Å—Å–æ–≤–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
- ‚úÖ –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ–¥–≥—Ä—É–ø–ø –¥–ª—è –∑–∞–Ω—è—Ç–∏–π
- ‚úÖ –£–∫–∞–∑–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏, –º–µ—Å—Ç–∞, —Ç–∏–ø–∞ –∑–∞–Ω—è—Ç–∏—è
- ‚úÖ –ü—Ä–æ—Å–º–æ—Ç—Ä —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –≤—Å–µ—Ö –≥—Ä—É–ø–ø

### –î–ª—è —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ ([[Student]])
- ‚úÖ –ü—Ä–æ—Å–º–æ—Ç—Ä –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–æ–≥–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –ø–æ–¥–≥—Ä—É–ø–ø–∞–º
- ‚úÖ –ö–∞–ª–µ–Ω–¥–∞—Ä–Ω—ã–π –≤–∏–¥
- ‚úÖ –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ –¥–µ–Ω—å/–Ω–µ–¥–µ–ª—é
- ‚úÖ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–∞–Ω—è—Ç–∏–∏ (–≤—Ä–µ–º—è, –º–µ—Å—Ç–æ, –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å)
- ‚úÖ Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –∑–∞–Ω—è—Ç–∏—è—Ö

### –î–ª—è –ª–µ–∫—Ç–æ—Ä–æ–≤ ([[Teacher]])
- ‚úÖ –ü—Ä–æ—Å–º–æ—Ç—Ä —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è —Å–≤–æ–∏—Ö –ø—Ä–µ–¥–º–µ—Ç–æ–≤
- ‚úÖ –ö–∞–ª–µ–Ω–¥–∞—Ä–Ω—ã–π –≤–∏–¥
- ‚úÖ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≥—Ä—É–ø–ø–∞—Ö
- ‚úÖ Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –∑–∞–Ω—è—Ç–∏—è—Ö

### –î–ª—è –º–µ–Ω—Ç–æ—Ä–æ–≤ ([[Mentor]])
- ‚úÖ –ü—Ä–æ—Å–º–æ—Ç—Ä —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è —Å–≤–æ–∏—Ö –≥—Ä—É–ø–ø
- ‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∑–∞–Ω—è—Ç–æ—Å—Ç–∏ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤
- ‚úÖ –ö–∞–ª–µ–Ω–¥–∞—Ä–Ω—ã–π –≤–∏–¥

## –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö

### Schedule
**–ú–æ–¥–µ–ª—å**: [[Schedule]]

```prisma
model Schedule {
  id          String   @id @default(cuid())
  subjectId   String
  groupId     String?
  subgroupId  String?  // null = –≤—Å—è –≥—Ä—É–ø–ø–∞, "1"/"2"/"3" = –ø–æ–¥–≥—Ä—É–ø–ø–∞
  date        DateTime
  dayOfWeek   Int      // 0-6
  startTime   String   // "HH:MM"
  endTime     String   // "HH:MM"
  location    String?
  eventType   String?  // –õ–µ–∫—Ü–∏—è, –°–µ–º–∏–Ω–∞—Ä, –ü—Ä–∞–∫—Ç–∏–∫–∞
  description String?
  isActive    Boolean
}
```

### –°–≤—è–∑–∞–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏
- [[Subject]] - –ø—Ä–µ–¥–º–µ—Ç –∑–∞–Ω—è—Ç–∏—è
- [[Group]] - –≥—Ä—É–ø–ø–∞ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤
- [[UserGroup]] - –ø–æ–¥–≥—Ä—É–ø–ø—ã —Å—Ç—É–¥–µ–Ω—Ç–æ–≤
- [[User]] - —Å—Ç—É–¥–µ–Ω—Ç—ã –∏ –ª–µ–∫—Ç–æ—Ä

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –°–æ–∑–¥–∞–Ω–∏–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è (Admin)

```mermaid
graph TD
    A[–ê–¥–º–∏–Ω –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç —Ñ–æ—Ä–º—É] --> B[–í—ã–±–∏—Ä–∞–µ—Ç –ø—Ä–µ–¥–º–µ—Ç]
    B --> C[–í—ã–±–∏—Ä–∞–µ—Ç –≥—Ä—É–ø–ø—É]
    C --> D{–ù—É–∂–Ω–∞ –ø–æ–¥–≥—Ä—É–ø–ø–∞?}
    D -->|–î–∞| E[–í—ã–±–∏—Ä–∞–µ—Ç –Ω–æ–º–µ—Ä –ø–æ–¥–≥—Ä—É–ø–ø—ã]
    D -->|–ù–µ—Ç| F[subgroupId = null]
    E --> G[–£–∫–∞–∑—ã–≤–∞–µ—Ç –¥–∞—Ç—É –∏ –≤—Ä–µ–º—è]
    F --> G
    G --> H[–£–∫–∞–∑—ã–≤–∞–µ—Ç –º–µ—Å—Ç–æ –∏ —Ç–∏–ø]
    H --> I[POST /api/schedules]
    I --> J[–°–æ–∑–¥–∞–Ω–æ –≤ –ë–î]
    J --> K[–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Å—Ç—É–¥–µ–Ω—Ç–∞–º]
```

### –ü—Ä–æ—Å–º–æ—Ç—Ä —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è (Student)

```mermaid
graph TD
    A[–°—Ç—É–¥–µ–Ω—Ç –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ] --> B[–°–∏—Å—Ç–µ–º–∞ –ø–æ–ª—É—á–∞–µ—Ç groupId —Å—Ç—É–¥–µ–Ω—Ç–∞]
    B --> C[–ü–æ–ª—É—á–∞–µ—Ç UserGroup —Å –ø–æ–¥–≥—Ä—É–ø–ø–∞–º–∏]
    C --> D[–°—Ç—Ä–æ–∏—Ç —Ñ–∏–ª—å—Ç—Ä OR]
    D --> E[subgroupId = null OR]
    E --> F[–ü—Ä–µ–¥–º–µ—Ç –ê + –ø–æ–¥–≥—Ä—É–ø–ø–∞ —Å—Ç—É–¥–µ–Ω—Ç–∞]
    F --> G[–ü—Ä–µ–¥–º–µ—Ç –ë + –ø–æ–¥–≥—Ä—É–ø–ø–∞ —Å—Ç—É–¥–µ–Ω—Ç–∞]
    G --> H[–ó–∞–ø—Ä–æ—Å –∫ –ë–î]
    H --> I[–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è]
```

## API Endpoints

**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: [[Schedules API]]

### GET /api/schedules
–ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è

**Query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã**:
- `groupId` - —Ñ–∏–ª—å—Ç—Ä –ø–æ –≥—Ä—É–ø–ø–µ
- `subjectId` - —Ñ–∏–ª—å—Ç—Ä –ø–æ –ø—Ä–µ–¥–º–µ—Ç—É
- `date` - –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∞—è –¥–∞—Ç–∞
- `startDate` + `endDate` - –¥–∏–∞–ø–∞–∑–æ–Ω –¥–∞—Ç

**–ü—Ä–∏–º–µ—Ä—ã**:
```typescript
// –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã –Ω–∞ –Ω–µ–¥–µ–ª—é
GET /api/schedules?groupId=group123&startDate=2024-11-04&endDate=2024-11-10

// –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –ø–æ –ø—Ä–µ–¥–º–µ—Ç—É
GET /api/schedules?subjectId=subject456

// –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –¥–µ–Ω—å
GET /api/schedules?date=2024-11-05
```

### POST /api/schedules (Admin only)
–°–æ–∑–¥–∞—Ç—å –∑–∞–Ω—è—Ç–∏–µ

**Body**:
```json
{
  "subjectId": "cuid...",
  "groupId": "cuid...",
  "subgroupId": "1",
  "date": "2024-11-05T10:00:00.000Z",
  "dayOfWeek": 1,
  "startTime": "10:00",
  "endTime": "11:30",
  "location": "–ê—É–¥. 123",
  "eventType": "–õ–µ–∫—Ü–∏—è",
  "description": "–í–≤–µ–¥–µ–Ω–∏–µ –≤ –∞–ª–≥–æ—Ä–∏—Ç–º—ã"
}
```

### PUT /api/schedules/[id] (Admin only)
–û–±–Ω–æ–≤–∏—Ç—å –∑–∞–Ω—è—Ç–∏–µ

### DELETE /api/schedules/[id] (Admin only)
–£–¥–∞–ª–∏—Ç—å –∑–∞–Ω—è—Ç–∏–µ

## –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### Admin –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
**–§–∞–π–ª**: `components/admin/schedule-form.tsx`

```typescript
'use client'

export function ScheduleForm() {
  return (
    <form>
      <Select name="subjectId" label="–ü—Ä–µ–¥–º–µ—Ç" />
      <Select name="groupId" label="–ì—Ä—É–ø–ø–∞" />
      <Select name="subgroupId" label="–ü–æ–¥–≥—Ä—É–ø–ø–∞">
        <option value="">–í—Å—è –≥—Ä—É–ø–ø–∞</option>
        <option value="1">–ü–æ–¥–≥—Ä—É–ø–ø–∞ 1</option>
        <option value="2">–ü–æ–¥–≥—Ä—É–ø–ø–∞ 2</option>
        <option value="3">–ü–æ–¥–≥—Ä—É–ø–ø–∞ 3</option>
      </Select>
      <DatePicker name="date" label="–î–∞—Ç–∞" />
      <Input name="startTime" type="time" label="–ù–∞—á–∞–ª–æ" />
      <Input name="endTime" type="time" label="–ö–æ–Ω–µ—Ü" />
      <Input name="location" label="–ú–µ—Å—Ç–æ" />
      <Select name="eventType" label="–¢–∏–ø –∑–∞–Ω—è—Ç–∏—è">
        <option value="–õ–µ–∫—Ü–∏—è">–õ–µ–∫—Ü–∏—è</option>
        <option value="–°–µ–º–∏–Ω–∞—Ä">–°–µ–º–∏–Ω–∞—Ä</option>
        <option value="–ü—Ä–∞–∫—Ç–∏–∫–∞">–ü—Ä–∞–∫—Ç–∏–∫–∞</option>
        <option value="–õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è">–õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è</option>
      </Select>
      <Button type="submit">–°–æ–∑–¥–∞—Ç—å</Button>
    </form>
  )
}
```

### Student –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
**–°—Ç—Ä–∞–Ω–∏—Ü—ã**:
- `app/student/page.tsx` - —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ –Ω–µ–¥–µ–ª—é
- `app/student/calendar/page.tsx` - –∫–∞–ª–µ–Ω–¥–∞—Ä–Ω—ã–π –≤–∏–¥

## –ü–æ–¥–≥—Ä—É–ø–ø—ã

**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: [[–°–∏—Å—Ç–µ–º–∞ –ø–æ–¥–≥—Ä—É–ø–ø]]  
**ADR**: [[ADR-006 –°–∏—Å—Ç–µ–º–∞ –ø–æ–¥–≥—Ä—É–ø–ø]]

### –ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã

–°—Ç—É–¥–µ–Ω—Ç –º–æ–∂–µ—Ç –±—ã—Ç—å –≤ —Ä–∞–∑–Ω—ã—Ö –ø–æ–¥–≥—Ä—É–ø–ø–∞—Ö –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –ø—Ä–µ–¥–º–µ—Ç–æ–≤. –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ:

```typescript
async function getStudentSchedule(studentId: string, groupId: string) {
  // 1. –ü–æ–ª—É—á–∏—Ç—å –ø–æ–¥–≥—Ä—É–ø–ø—ã —Å—Ç—É–¥–µ–Ω—Ç–∞
  const userGroup = await prisma.userGroup.findUnique({
    where: {
      userId_groupId: { userId: studentId, groupId: groupId }
    }
  })
  
  // 2. –ü–æ–ª—É—á–∏—Ç—å ID –ø—Ä–µ–¥–º–µ—Ç–æ–≤
  const subjects = await prisma.subject.findMany()
  const commerceSubject = subjects.find(s => s.name === '–ö–æ–º–º–µ—Ä—Ü–∏—è')
  const tutorialSubject = subjects.find(s => s.name === '–°–µ–º–∏–Ω–∞—Ä—ã')
  // ... –∏ –¥—Ä—É–≥–∏–µ
  
  // 3. –ü–æ—Å—Ç—Ä–æ–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä
  const schedules = await prisma.schedule.findMany({
    where: {
      groupId: groupId,
      OR: [
        { subgroupId: null }, // –î–ª—è –≤—Å–µ–π –≥—Ä—É–ø–ø—ã
        {
          subjectId: commerceSubject?.id,
          subgroupId: userGroup?.subgroupCommerce?.toString()
        },
        {
          subjectId: tutorialSubject?.id,
          subgroupId: userGroup?.subgroupTutorial?.toString()
        }
        // ... –¥–ª—è –¥—Ä—É–≥–∏—Ö –ø—Ä–µ–¥–º–µ—Ç–æ–≤ —Å –ø–æ–¥–≥—Ä—É–ø–ø–∞–º–∏
      ]
    },
    include: {
      subject: {
        include: {
          Teacher: true
        }
      }
    },
    orderBy: [
      { date: 'asc' },
      { startTime: 'asc' }
    ]
  })
  
  return schedules
}
```

### –ü—Ä–∏–º–µ—Ä

**–°—Ç—É–¥–µ–Ω—Ç –ò–≤–∞–Ω**:
- –ö–æ–º–º–µ—Ä—Ü–∏—è - –ø–æ–¥–≥—Ä—É–ø–ø–∞ 1
- –°–µ–º–∏–Ω–∞—Ä—ã - –ø–æ–¥–≥—Ä—É–ø–ø–∞ 2

**–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã**:
1. –ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞ (–≤—Å—è –≥—Ä—É–ø–ø–∞) - –ò–≤–∞–Ω **–≤–∏–¥–∏—Ç** ‚úÖ
2. –ö–æ–º–º–µ—Ä—Ü–∏—è –ø–æ–¥–≥—Ä—É–ø–ø–∞ 1 - –ò–≤–∞–Ω **–≤–∏–¥–∏—Ç** ‚úÖ
3. –ö–æ–º–º–µ—Ä—Ü–∏—è –ø–æ–¥–≥—Ä—É–ø–ø–∞ 2 - –ò–≤–∞–Ω **–Ω–µ –≤–∏–¥–∏—Ç** ‚ùå
4. –°–µ–º–∏–Ω–∞—Ä—ã –ø–æ–¥–≥—Ä—É–ø–ø–∞ 1 - –ò–≤–∞–Ω **–Ω–µ –≤–∏–¥–∏—Ç** ‚ùå
5. –°–µ–º–∏–Ω–∞—Ä—ã –ø–æ–¥–≥—Ä—É–ø–ø–∞ 2 - –ò–≤–∞–Ω **–≤–∏–¥–∏—Ç** ‚úÖ

## –¢–∏–ø—ã –∑–∞–Ω—è—Ç–∏–π

### –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —Ç–∏–ø—ã
- **–õ–µ–∫—Ü–∏—è** - –æ—Å–Ω–æ–≤–Ω–æ–µ –∑–∞–Ω—è—Ç–∏–µ –¥–ª—è –≤—Å–µ–π –≥—Ä—É–ø–ø—ã
- **–°–µ–º–∏–Ω–∞—Ä** - –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–Ω—è—Ç–∏—è (—á–∞—Å—Ç–æ –ø–æ –ø–æ–¥–≥—Ä—É–ø–ø–∞–º)
- **–ü—Ä–∞–∫—Ç–∏–∫–∞** - –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Ä–∞–±–æ—Ç—ã
- **–õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è** - –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω—ã–µ —Ä–∞–±–æ—Ç—ã
- **–ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è** - –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ –ø–µ—Ä–µ–¥ —ç–∫–∑–∞–º–µ–Ω–æ–º
- **–≠–∫–∑–∞–º–µ–Ω** - —ç–∫–∑–∞–º–µ–Ω –ø–æ –ø—Ä–µ–¥–º–µ—Ç—É

### –¶–≤–µ—Ç–æ–≤–æ–µ –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ (UI)

```typescript
const eventTypeColors = {
  '–õ–µ–∫—Ü–∏—è': 'bg-blue-500',
  '–°–µ–º–∏–Ω–∞—Ä': 'bg-green-500',
  '–ü—Ä–∞–∫—Ç–∏–∫–∞': 'bg-yellow-500',
  '–õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è': 'bg-purple-500',
  '–ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è': 'bg-orange-500',
  '–≠–∫–∑–∞–º–µ–Ω': 'bg-red-500'
}
```

## –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

**–°–∏—Å—Ç–µ–º–∞**: [[Telegram –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è]]

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

#### –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ –∑–∞–Ω—è—Ç–∏–∏ (–∑–∞ 30 –º–∏–Ω—É—Ç)
```typescript
// Cron –∑–∞–¥–∞—á–∞ –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
async function sendScheduleReminders() {
  const now = new Date()
  const in30Minutes = new Date(now.getTime() + 30 * 60000)
  
  const upcomingSchedules = await prisma.schedule.findMany({
    where: {
      date: {
        gte: now,
        lte: in30Minutes
      },
      isActive: true
    },
    include: {
      subject: {
        include: {
          Teacher: {
            include: { telegramUser: true }
          }
        }
      },
      group: {
        include: {
          users: {
            where: { role: 'student' },
            include: { telegramUser: true }
          }
        }
      }
    }
  })
  
  for (const schedule of upcomingSchedules) {
    // –£–≤–µ–¥–æ–º–∏—Ç—å —Å—Ç—É–¥–µ–Ω—Ç–æ–≤
    for (const student of schedule.group.users) {
      if (student.telegramUser?.notifications) {
        await sendTelegramMessage(student.telegramUser.chatId, {
          text: `üìö –ß–µ—Ä–µ–∑ 30 –º–∏–Ω—É—Ç: ${schedule.subject.name}
üìç ${schedule.location}
üïê ${schedule.startTime}-${schedule.endTime}`
        })
      }
    }
    
    // –£–≤–µ–¥–æ–º–∏—Ç—å –ª–µ–∫—Ç–æ—Ä–∞
    if (schedule.subject.Teacher?.telegramUser?.notifications) {
      await sendTelegramMessage(
        schedule.subject.Teacher.telegramUser.chatId,
        {
          text: `üìö –ß–µ—Ä–µ–∑ 30 –º–∏–Ω—É—Ç: ${schedule.subject.name}
üë• –ì—Ä—É–ø–ø–∞: ${schedule.group.name}
üìç ${schedule.location}`
        }
      )
    }
  }
}
```

#### –î–Ω–µ–≤–Ω–∞—è —Å–≤–æ–¥–∫–∞ (–µ–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ 7:00)
```typescript
async function sendDailySummary() {
  const today = new Date()
  today.setHours(0, 0, 0, 0)
  const tomorrow = new Date(today)
  tomorrow.setDate(tomorrow.getDate() + 1)
  
  const users = await prisma.user.findMany({
    where: {
      telegramUser: {
        notifications: true
      }
    },
    include: {
      telegramUser: true,
      group: true
    }
  })
  
  for (const user of users) {
    const todaySchedule = await getStudentSchedule(
      user.id,
      user.groupId,
      today,
      tomorrow
    )
    
    if (todaySchedule.length > 0) {
      const message = `üåÖ –î–æ–±—Ä–æ–µ —É—Ç—Ä–æ! –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è:\n\n` +
        todaySchedule.map(s => 
          `${s.startTime} - ${s.subject.name} (${s.location})`
        ).join('\n')
      
      await sendTelegramMessage(user.telegramUser.chatId, { text: message })
    }
  }
}
```

## –ú–∞—Å—Å–æ–≤–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è

### –°–æ–∑–¥–∞–Ω–∏–µ –Ω–∞ –≤–µ—Å—å —Å–µ–º–µ—Å—Ç—Ä
```typescript
async function createSemesterSchedule({
  subjectId,
  groupId,
  dayOfWeek,
  startTime,
  endTime,
  location,
  eventType,
  startDate,
  endDate
}: CreateSemesterScheduleParams) {
  const schedules = []
  
  // –ù–∞–π—Ç–∏ –≤—Å–µ –¥–∞—Ç—ã —Å –Ω—É–∂–Ω—ã–º –¥–Ω–µ–º –Ω–µ–¥–µ–ª–∏
  for (
    let date = new Date(startDate);
    date <= endDate;
    date.setDate(date.getDate() + 7)  // +1 –Ω–µ–¥–µ–ª—è
  ) {
    if (date.getDay() === dayOfWeek) {
      schedules.push({
        subjectId,
        groupId,
        date: new Date(date),
        dayOfWeek,
        startTime,
        endTime,
        location,
        eventType
      })
    }
  }
  
  await prisma.schedule.createMany({
    data: schedules
  })
  
  return schedules.length
}

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
await createSemesterSchedule({
  subjectId: 'math-id',
  groupId: 'group-id',
  dayOfWeek: 1,  // –ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫
  startTime: '10:00',
  endTime: '11:30',
  location: '–ê—É–¥. 123',
  eventType: '–õ–µ–∫—Ü–∏—è',
  startDate: new Date('2024-09-01'),
  endDate: new Date('2024-12-31')
})
```

## –≠–∫—Å–ø–æ—Ä—Ç —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è

### –í iCal —Ñ–æ—Ä–º–∞—Ç
```typescript
function exportToiCal(schedules: Schedule[]): string {
  let ical = 'BEGIN:VCALENDAR\nVERSION:2.0\nPRODID:-//Shked//RU\n'
  
  for (const schedule of schedules) {
    const startDateTime = new Date(schedule.date)
    const [startHour, startMin] = schedule.startTime.split(':')
    startDateTime.setHours(parseInt(startHour), parseInt(startMin))
    
    const endDateTime = new Date(schedule.date)
    const [endHour, endMin] = schedule.endTime.split(':')
    endDateTime.setHours(parseInt(endHour), parseInt(endMin))
    
    ical += `BEGIN:VEVENT\n`
    ical += `DTSTART:${formatICalDate(startDateTime)}\n`
    ical += `DTEND:${formatICalDate(endDateTime)}\n`
    ical += `SUMMARY:${schedule.subject.name}\n`
    ical += `LOCATION:${schedule.location}\n`
    ical += `DESCRIPTION:${schedule.eventType}\n`
    ical += `END:VEVENT\n`
  }
  
  ical += 'END:VCALENDAR'
  return ical
}
```

## –°–≤—è–∑–∞–Ω–Ω—ã–µ –∑–∞–º–µ—Ç–∫–∏

### –ú–æ–¥–µ–ª–∏
- [[Schedule]] - –º–æ–¥–µ–ª—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
- [[Subject]] - –ø—Ä–µ–¥–º–µ—Ç
- [[Group]] - –≥—Ä—É–ø–ø–∞
- [[UserGroup]] - –ø–æ–¥–≥—Ä—É–ø–ø—ã
- [[User]] - —Å—Ç—É–¥–µ–Ω—Ç—ã –∏ –ª–µ–∫—Ç–æ—Ä

### –§—É–Ω–∫—Ü–∏–∏
- [[–°–∏—Å—Ç–µ–º–∞ –ø–æ–¥–≥—Ä—É–ø–ø]] - —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
- [[Telegram –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è]] - —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

### API
- [[Schedules API]] - endpoints

### –†–æ–ª–∏
- [[Admin]] - —Å–æ–∑–¥–∞–Ω–∏–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
- [[Student]] - –ø—Ä–æ—Å–º–æ—Ç—Ä —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
- [[Teacher]] - –ø—Ä–æ—Å–º–æ—Ç—Ä —Å–≤–æ–µ–≥–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
- [[Mentor]] - –ø—Ä–æ—Å–º–æ—Ç—Ä —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –≥—Ä—É–ø–ø

### ADR
- [[ADR-006 –°–∏—Å—Ç–µ–º–∞ –ø–æ–¥–≥—Ä—É–ø–ø]]

## –§–∞–π–ª—ã

- **–ú–æ–¥–µ–ª—å**: `prisma/schema.prisma`
- **API**: `app/api/schedules/route.ts`
- **Admin —Å—Ç—Ä–∞–Ω–∏—Ü—ã**: `app/admin/schedule/page.tsx`
- **Student —Å—Ç—Ä–∞–Ω–∏—Ü—ã**: 
  - `app/student/page.tsx`
  - `app/student/calendar/page.tsx`
- **–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã**: `components/admin/schedule-form.tsx`
- **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è**: `lib/telegram/notifications.ts`
- **Cron**: `lib/cron/init.ts`

## –û—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- [docs/README.md](../../docs/README.md)

---

#function #schedule #timetable #core

