# ADR-004: Telegram –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å LLM –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π

**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ü—Ä–∏–Ω—è—Ç–æ  
**–î–∞—Ç–∞**: –§–µ–≤—Ä–∞–ª—å 2024  
**–ê–≤—Ç–æ—Ä—ã**: –ü–∞–≤–µ–ª –®–µ—Ä—à–Ω—ë–≤  
**–°–≤—è–∑–∏**: [[Telegram –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è]], [[–°–∏—Å—Ç–µ–º–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π]], [[LLM –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤]]

## –ö–æ–Ω—Ç–µ–∫—Å—Ç –∏ –ø—Ä–æ–±–ª–µ–º–∞

–°—Ç—É–¥–µ–Ω—Ç–∞–º –∏ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è–º –Ω—É–∂–µ–Ω —É–¥–æ–±–Ω—ã–π —Å–ø–æ—Å–æ–±:
- –ü–æ–ª—É—á–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –∑–∞–Ω—è—Ç–∏—è—Ö –∏ –¥–µ–¥–ª–∞–π–Ω–∞—Ö
- –ë—ã—Å—Ç—Ä–æ –ø—Ä–æ–≤–µ—Ä—è—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –±–µ–∑ –≤—Ö–æ–¥–∞ –≤ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
- –ó–∞–¥–∞–≤–∞—Ç—å –≤–æ–ø—Ä–æ—Å—ã –Ω–∞ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–º —è–∑—ã–∫–µ
- –ü–æ–ª—É—á–∞—Ç—å –¥–Ω–µ–≤–Ω—ã–µ —Å–≤–æ–¥–∫–∏ –∏ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è

–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—ã–±—Ä–∞—Ç—å –ø–ª–∞—Ç—Ñ–æ—Ä–º—É –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∏ —Å–ø–æ—Å–æ–± –æ–±—Ä–∞–±–æ—Ç–∫–∏ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —è–∑—ã–∫–∞.

## –†–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã

### –í—ã–±–æ—Ä –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã

#### 1. Telegram Bot ‚úÖ
**–ü–ª—é—Å—ã**:
- ‚úÖ –ü–æ–ø—É–ª—è—Ä–µ–Ω –≤ —Å—Ç—É–¥–µ–Ω—á–µ—Å–∫–æ–π —Å—Ä–µ–¥–µ –ú–§–¢–ò
- ‚úÖ –ü—Ä–æ—Å—Ç–æ–π Bot API
- ‚úÖ Webhook –¥–ª—è real-time –æ–±—Ä–∞–±–æ—Ç–∫–∏
- ‚úÖ Rich —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (Markdown, –∫–Ω–æ–ø–∫–∏)
- ‚úÖ –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π
- ‚úÖ –•–æ—Ä–æ—à–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

**–ú–∏–Ω—É—Å—ã**:
- ‚ö†Ô∏è –ù—É–∂–µ–Ω –ø—É–±–ª–∏—á–Ω—ã–π HTTPS endpoint –¥–ª—è webhook

#### 2. WhatsApp Business API
**–ü–ª—é—Å—ã**:
- ‚úÖ –®–∏—Ä–æ–∫–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è

**–ú–∏–Ω—É—Å—ã**:
- ‚ùå –ü–ª–∞—Ç–Ω—ã–π (—Å—Ç–æ–∏–º–æ—Å—Ç—å –∑–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ)
- ‚ùå –°–ª–æ–∂–Ω–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –±–∏–∑–Ω–µ—Å–∞
- ‚ùå –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ –∏—Å—Ö–æ–¥—è—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è

#### 3. VK Bots
**–ü–ª—é—Å—ã**:
- ‚úÖ –ü–æ–ø—É–ª—è—Ä–µ–Ω –≤ –†–æ—Å—Å–∏–∏

**–ú–∏–Ω—É—Å—ã**:
- ‚ùå –ú–µ–Ω—å—à–µ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –∏—Å–ø–æ–ª—å–∑—É—é—Ç VK
- ‚ùå –°–ª–æ–∂–Ω–µ–µ API

### –í—ã–±–æ—Ä LLM –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤

#### 1. GigaChat (–°–±–µ—Ä) ‚úÖ
**–ü–ª—é—Å—ã**:
- ‚úÖ –†–æ—Å—Å–∏–π—Å–∫–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ (—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º)
- ‚úÖ –ü–æ–Ω–∏–º–∞–µ—Ç —Ä—É—Å—Å–∫–∏–π —è–∑—ã–∫ –Ω–∞—Ç–∏–≤–Ω–æ
- ‚úÖ API —Å–æ–≤–º–µ—Å—Ç–∏–º —Å OpenAI
- ‚úÖ –î–æ—Å—Ç—É–ø –¥–ª—è –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤

**–ú–∏–Ω—É—Å—ã**:
- ‚ö†Ô∏è –ú–µ–Ω—å—à–µ –ø—Ä–∏–º–µ—Ä–æ–≤ –∏ —Ç—É—Ç–æ—Ä–∏–∞–ª–æ–≤
- ‚ö†Ô∏è –í–æ–∑–º–æ–∂–Ω—ã –ª–∏–º–∏—Ç—ã –Ω–∞ –±–µ—Å–ø–ª–∞—Ç–Ω–æ–º —Ç–∞—Ä–∏—Ñ–µ

#### 2. OpenAI GPT
**–ü–ª—é—Å—ã**:
- ‚úÖ –õ—É—á—à–µ–µ –∫–∞—á–µ—Å—Ç–≤–æ –æ—Ç–≤–µ—Ç–æ–≤
- ‚úÖ –ú–Ω–æ–≥–æ –ø—Ä–∏–º–µ—Ä–æ–≤ –∏ –±–∏–±–ª–∏–æ—Ç–µ–∫

**–ú–∏–Ω—É—Å—ã**:
- ‚ùå –ü–ª–∞—Ç–Ω—ã–π (–∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã–µ –∑–∞—Ç—Ä–∞—Ç—ã)
- ‚ùå –¢—Ä–µ–±—É–µ—Ç VPN –≤ –†–æ—Å—Å–∏–∏
- ‚ùå –ü—Ä–æ–±–ª–µ–º—ã —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π —Ä—É—Å—Å–∫–æ–≥–æ —è–∑—ã–∫–∞

#### 3. Yandex GPT
**–ü–ª—é—Å—ã**:
- ‚úÖ –†–æ—Å—Å–∏–π—Å–∫–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞

**–ú–∏–Ω—É—Å—ã**:
- ‚ùå –ó–∞–∫—Ä—ã—Ç–∞—è beta
- ‚ùå –ù–µ—è—Å–Ω–æ–µ —Ü–µ–Ω–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ

## –†–µ—à–µ–Ω–∏–µ

**–í—ã–±—Ä–∞–Ω–∞ —Å–≤—è–∑–∫–∞: Telegram Bot + GigaChat API**

### –û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ

1. **Telegram**: 90%+ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –ú–§–¢–ò –∏—Å–ø–æ–ª—å–∑—É—é—Ç Telegram –µ–∂–µ–¥–Ω–µ–≤–Ω–æ

2. **GigaChat**: –û–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å –∫–∞—á–µ—Å—Ç–≤–∞, —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º

3. **Webhook vs Polling**: Webhook –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç instant –æ—Ç–≤–µ—Ç—ã

4. **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**:
   ```
   –°—Ç—É–¥–µ–Ω—Ç ‚Üí Telegram ‚Üí Webhook ‚Üí Next.js API ‚Üí GigaChat ‚Üí –û—Ç–≤–µ—Ç
                                    ‚Üì
                                 Prisma DB (–∫–æ–Ω—Ç–µ–∫—Å—Ç)
   ```

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã

```mermaid
graph TB
    A[Telegram User] -->|–°–æ–æ–±—â–µ–Ω–∏–µ| B[Telegram Bot API]
    B -->|Webhook POST| C[/api/telegram/webhook]
    C -->|–û–±—Ä–∞–±–æ—Ç–∫–∞| D[lib/telegram/commands.ts]
    D -->|–ö–æ–Ω—Ç–µ–∫—Å—Ç| E[Prisma DB]
    D -->|–ó–∞–ø—Ä–æ—Å| F[lib/telegram/llm.ts]
    F -->|API Call| G[GigaChat API]
    G -->|–û—Ç–≤–µ—Ç| F
    F -->|–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ| D
    D -->|sendMessage| B
    B -->|–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ| A
```

### –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö

#### TelegramUser
```prisma
model TelegramUser {
  id            String   @id @default(cuid())
  userId        String   @unique
  telegramId    String   @unique
  chatId        String
  username      String?
  notifications Boolean  @default(true)
  user          User     @relation(...)
}
```

#### BotSettings
```prisma
model BotSettings {
  id                   String   @id @default(cuid())
  telegramBotToken     String?
  openaiApiKey         String?
  isActive             Boolean  @default(false)
  reminderMinutes      Int      @default(30)
  dailySummaryTime     String   @default("07:00")
}
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–¥–∞

```
lib/telegram/
‚îú‚îÄ‚îÄ bot.ts              # Telegram Bot client
‚îú‚îÄ‚îÄ llm.ts              # GigaChat –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ commands.ts         # –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥
‚îú‚îÄ‚îÄ notifications.ts    # –°–∏—Å—Ç–µ–º–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
‚îî‚îÄ‚îÄ helpers.ts          # –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

app/api/telegram/
‚îú‚îÄ‚îÄ webhook/route.ts    # Webhook handler
‚îú‚îÄ‚îÄ config/route.ts     # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±–æ—Ç–∞ (admin)
‚îú‚îÄ‚îÄ link/route.ts       # –ü—Ä–∏–≤—è–∑–∫–∞ –∞–∫–∫–∞—É–Ω—Ç–æ–≤
‚îú‚îÄ‚îÄ send/route.ts       # –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
‚îî‚îÄ‚îÄ stats/route.ts      # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

lib/cron/
‚îî‚îÄ‚îÄ init.ts            # Cron –∑–∞–¥–∞—á–∏ –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
```

## –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

### –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞

**–ë–∞–∑–æ–≤—ã–µ**:
- `/start` - –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏
- `/help` - —Å–ø–∏—Å–æ–∫ –∫–æ–º–∞–Ω–¥
- `/link [token]` - –ø—Ä–∏–≤—è–∑–∫–∞ –∞–∫–∫–∞—É–Ω—Ç–∞

**–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ**:
- `/schedule` - —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è
- `/tomorrow` - —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ –∑–∞–≤—Ç—Ä–∞
- `/week` - —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ –Ω–µ–¥–µ–ª—é

**–î–æ–º–∞—à–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è**:
- `/homework` - –º–æ–∏ –¥–æ–º–∞—à–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è
- `/homework_due` - –±–ª–∏–∂–∞–π—à–∏–µ –¥–µ–¥–ª–∞–π–Ω—ã

**–ù–∞—Å—Ç—Ä–æ–π–∫–∏**:
- `/settings` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

### –ï—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–π —è–∑—ã–∫ (—á–µ—Ä–µ–∑ GigaChat)

**–ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤**:
- "–ö–æ–≥–¥–∞ –º–æ—è —Å–ª–µ–¥—É—é—â–∞—è –ø–∞—Ä–∞?"
- "–ß—Ç–æ —É –º–µ–Ω—è –∑–∞–≤—Ç—Ä–∞?"
- "–ü–æ–∫–∞–∂–∏ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ –Ω–µ–¥–µ–ª—é"
- "–ö–∞–∫–∏–µ –¥–æ–º–∞—à–∫–∏ —É –º–µ–Ω—è –µ—Å—Ç—å?"
- "–ö–æ–≥–¥–∞ —Å–¥–∞–≤–∞—Ç—å –î–ó –ø–æ –º–∞—Ç–µ–º–∞—Ç–∏–∫–µ?"

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (Cron)

**1. –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –æ –∑–∞–Ω—è—Ç–∏—è—Ö** (–∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç)
- –ó–∞ 30 –º–∏–Ω—É—Ç –¥–æ –Ω–∞—á–∞–ª–∞ –ø–∞—Ä—ã
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å—Ç—É–¥–µ–Ω—Ç–∞–º –∏ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è–º

**2. –î–Ω–µ–≤–Ω—ã–µ —Å–≤–æ–¥–∫–∏** (–µ–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ 7:00)
- –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ –¥–µ–Ω—å
- –î–µ–¥–ª–∞–π–Ω—ã —Å–µ–≥–æ–¥–Ω—è

**3. –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –æ –î–ó** (–∫–∞–∂–¥—ã–µ 2 —á–∞—Å–∞)
- –ó–∞ 24 —á–∞—Å–∞ –¥–æ –¥–µ–¥–ª–∞–π–Ω–∞
- –ó–∞ 2 —á–∞—Å–∞ –¥–æ –¥–µ–¥–ª–∞–π–Ω–∞

**4. –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–µ —Å–≤–æ–¥–∫–∏** (–ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫, 8:00)
- –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ –Ω–µ–¥–µ–ª—é
- –í—Å–µ –¥–µ–¥–ª–∞–π–Ω—ã –Ω–µ–¥–µ–ª–∏

## –ü—Ä–∏–≤—è–∑–∫–∞ –∞–∫–∫–∞—É–Ω—Ç–æ–≤

### Workflow
1. –°—Ç—É–¥–µ–Ω—Ç –∑–∞—Ö–æ–¥–∏—Ç –≤ –ø—Ä–æ—Ñ–∏–ª—å –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
2. –ù–∞–∂–∏–º–∞–µ—Ç "–ü–æ–ª—É—á–∏—Ç—å —Ç–æ–∫–µ–Ω –ø—Ä–∏–≤—è–∑–∫–∏"
3. –°–∏—Å—Ç–µ–º–∞ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ç–æ–∫–µ–Ω (TTL 15 –º–∏–Ω—É—Ç)
4. –°—Ç—É–¥–µ–Ω—Ç –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç Telegram –±–æ—Ç–∞
5. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `/link TOKEN`
6. –ë–æ—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–æ–∫–µ–Ω –∏ –ø—Ä–∏–≤—è–∑—ã–≤–∞–µ—Ç –∞–∫–∫–∞—É–Ω—Ç
7. –°—Ç—É–¥–µ–Ω—Ç –ø–æ–ª—É—á–∞–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- ‚úÖ –¢–æ–∫–µ–Ω—ã –æ–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–µ
- ‚úÖ TTL 15 –º–∏–Ω—É—Ç
- ‚úÖ –ü—Ä–∏–≤—è–∑–∫–∞ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –≤ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏

## GigaChat –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

### System Prompt

–ö–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è LLM –≤–∫–ª—é—á–∞–µ—Ç:
- –†–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—Å—Ç—É–¥–µ–Ω—Ç/–∞–¥–º–∏–Ω/–ª–µ–∫—Ç–æ—Ä)
- –ì—Ä—É–ø–ø–∞ –∏ –ø–æ–¥–≥—Ä—É–ø–ø—ã —Å—Ç—É–¥–µ–Ω—Ç–∞
- –¢–µ–∫—É—â–∞—è –¥–∞—Ç–∞ –∏ –≤—Ä–µ–º—è
- –ë–ª–∏–∂–∞–π—à–µ–µ –∑–∞–Ω—è—Ç–∏–µ (–µ—Å–ª–∏ –µ—Å—Ç—å)
- –°–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∫–æ–º–∞–Ω–¥

### –ü—Ä–∏–º–µ—Ä system prompt
```
–¢—ã - –ø–æ–º–æ—â–Ω–∏–∫ —Å–∏—Å—Ç–µ–º—ã —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –ú–§–¢–ò "–®–ö–ï–î".
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤ (—Å—Ç—É–¥–µ–Ω—Ç –≥—Ä—É–ø–ø—ã –ë05-123)
–°–µ–π—á–∞—Å: 20 –æ–∫—Ç—è–±—Ä—è 2025, 10:30
–°–ª–µ–¥—É—é—â–µ–µ –∑–∞–Ω—è—Ç–∏–µ: –ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞ –≤ 12:00 (–∞—É–¥. 123)

–û—Ç–≤–µ—á–∞–π –∫—Ä–∞—Ç–∫–æ –∏ –ø–æ –¥–µ–ª—É. –ò—Å–ø–æ–ª—å–∑—É–π –∫–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞ –¥–ª—è –¥–µ–π—Å—Ç–≤–∏–π.
```

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–∞
```typescript
async function processWithLLM(message: string, context: UserContext) {
  const response = await gigachat.chat({
    model: 'GigaChat',
    messages: [
      { role: 'system', content: buildSystemPrompt(context) },
      { role: 'user', content: message }
    ]
  })
  
  return response.choices[0].message.content
}
```

## –ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è

### –ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–µ

- ‚úÖ **–£–¥–æ–±—Å—Ç–≤–æ**: –°—Ç—É–¥–µ–Ω—Ç—ã –º–æ–≥—É—Ç –ø—Ä–æ–≤–µ—Ä—è—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–µ –∑–∞—Ö–æ–¥—è –≤ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
- ‚úÖ **–°–≤–æ–µ–≤—Ä–µ–º–µ–Ω–Ω–æ—Å—Ç—å**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –æ –ø–∞—Ä–∞—Ö –∏ –¥–µ–¥–ª–∞–π–Ω–∞—Ö
- ‚úÖ **–ï—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å**: LLM –ø–æ–Ω–∏–º–∞–µ—Ç –≤–æ–ø—Ä–æ—Å—ã –Ω–∞ —Ä—É—Å—Å–∫–æ–º
- ‚úÖ **Engagement**: –ü–æ–≤—ã—à–∞–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã
- ‚úÖ **–≠–∫–æ–Ω–æ–º–∏—è –≤—Ä–µ–º–µ–Ω–∏**: –ë—ã—Å—Ç—Ä—ã–µ –æ—Ç–≤–µ—Ç—ã –±–µ–∑ –ø–æ–∏—Å–∫–∞ –≤ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ

### –ù–µ–≥–∞—Ç–∏–≤–Ω—ã–µ

- ‚ö†Ô∏è **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç –≤–Ω–µ—à–Ω–∏—Ö API**: Telegram –∏ GigaChat
- ‚ö†Ô∏è **–°—Ç–æ–∏–º–æ—Å—Ç—å**: –í–æ–∑–º–æ–∂–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã –Ω–∞ GigaChat (–ø—Ä–∏ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–∏)
- ‚ö†Ô∏è **–°–ª–æ–∂–Ω–æ—Å—Ç—å**: –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (webhook, cron)
- ‚ö†Ô∏è **–ü–æ–¥–¥–µ—Ä–∂–∫–∞**: –ù—É–∂–Ω–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –æ—à–∏–±–∫–∏ API

### –°–º—è–≥—á–µ–Ω–∏—è

1. **Fallback**: –ü—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ GigaChat –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ –æ—Ç–≤–µ—Ç—ã
2. **Rate limiting**: –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ LLM
3. **–ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ß–∞—Å—Ç–æ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º—ã–µ –¥–∞–Ω–Ω—ã–µ –∫–µ—à–∏—Ä—É—é—Ç—Å—è
4. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**: –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö webhook –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ –æ—à–∏–±–æ–∫

## –í–ª–∏—è–Ω–∏–µ –Ω–∞ –¥—Ä—É–≥–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### –ó–∞—Ç—Ä–æ–Ω—É—Ç—ã–µ –æ–±–ª–∞—Å—Ç–∏
- [[API Routes]] - –Ω–æ–≤—ã–µ endpoints –¥–ª—è Telegram
- [[–°–∏—Å—Ç–µ–º–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π]] - cron –∑–∞–¥–∞—á–∏
- [[–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö]] - –º–æ–¥–µ–ª–∏ TelegramUser –∏ BotSettings
- [[Admin –ø–∞–Ω–µ–ª—å]] - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±–æ—Ç–∞
- [[Deployment]] - webhook URL, HTTPS —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ

### –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è
- [[ADR-001 Next.js 14 App Router]] - API routes –¥–ª—è webhook
- [[ADR-002 Prisma ORM]] - –º–æ–¥–µ–ª–∏ –¥–ª—è Telegram
- [[ADR-005 MDX –¥–ª—è –¥–æ–º–∞—à–Ω–∏—Ö –∑–∞–¥–∞–Ω–∏–π]] - —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ Telegram

## –ü—Ä–∏–º–µ—Ä—ã –∫–æ–¥–∞

### Webhook handler
```typescript
// app/api/telegram/webhook/route.ts
export async function POST(request: NextRequest) {
  const update = await request.json()
  
  if (update.message) {
    await handleMessage(update.message)
  }
  
  return NextResponse.json({ ok: true })
}
```

### –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
```typescript
// lib/telegram/notifications.ts
export async function sendClassReminder(userId: string, schedule: Schedule) {
  const telegramUser = await prisma.telegramUser.findUnique({
    where: { userId }
  })
  
  if (!telegramUser?.notifications) return
  
  await bot.sendMessage(telegramUser.chatId, 
    `üìö –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ: —á–µ—Ä–µ–∑ 30 –º–∏–Ω—É—Ç ${schedule.subject.name} –≤ ${schedule.location}`
  )
}
```

### LLM –∑–∞–ø—Ä–æ—Å
```typescript
// lib/telegram/llm.ts
export async function askGigaChat(question: string, context: Context) {
  const response = await fetch('https://gigachat.devices.sberbank.ru/api/v1/chat/completions', {
    method: 'POST',
    headers: {
      'Authorization': `Bearer ${apiKey}`,
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      model: 'GigaChat',
      messages: [
        { role: 'system', content: buildPrompt(context) },
        { role: 'user', content: question }
      ]
    })
  })
  
  return response.json()
}
```

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –º–µ—Ç—Ä–∏–∫–∏

### –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º—ã–µ –º–µ—Ç—Ä–∏–∫–∏
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –¥–µ–Ω—å
- –£—Å–ø–µ—à–Ω–æ—Å—Ç—å –¥–æ—Å—Ç–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ –±–æ—Ç–∞
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ LLM (–∑–∞–ø—Ä–æ—Å—ã/–¥–µ–Ω—å)
- –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

### –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å
–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ –≤ `/admin/settings`:
- –ü—Ä–æ—Ü–µ–Ω—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –ì—Ä–∞—Ñ–∏–∫ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∑–∞ –Ω–µ–¥–µ–ª—é
- –°—Ç–∞—Ç—É—Å webhook
- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

## –°—Å—ã–ª–∫–∏

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- [Telegram Bot API](https://core.telegram.org/bots/api)
- [GigaChat API](https://developers.sber.ru/docs/ru/gigachat/overview)
- –û—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è: [docs/features/TELEGRAM_BOT.md](../../docs/features/TELEGRAM_BOT.md)

### –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ —Ä–µ—Å—É—Ä—Å—ã
- [[Telegram –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è]]
- [[Telegram API]]
- [[–°–∏—Å—Ç–µ–º–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π]]
- [[LLM –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤]]
- [[TelegramUser]] –º–æ–¥–µ–ª—å
- [[BotSettings]] –º–æ–¥–µ–ª—å

## –ò—Å—Ç–æ—Ä–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π

- **2024-02**: –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ
- **2024-03**: –î–æ–±–∞–≤–ª–µ–Ω–∞ LLM –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å GigaChat
- **2024-04**: –í–Ω–µ–¥—Ä–µ–Ω—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- **2024-10**: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è cron –∑–∞–¥–∞—á

---

#adr #architecture #telegram #llm #gigachat #decision #integration

